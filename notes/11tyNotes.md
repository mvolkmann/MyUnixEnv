# 11ty Notes

See https://github.com/jeromecoupe/iad_eleventy_introduction/blob/master/eleventy_introduction_en.md

See https://www.11ty.dev/docs/plugins/navigation/

## Static site generators (SSGs)

SSGs are an alternative to CMS tools (like WordPress and Drupal)
and graphical site builders (like Squarespace and Wix).

The primary benefits of SSGs are:

- Static sites provide excellent runtime performance.
- Static sites are more secure because all API interactions
  occur during site generation, not when users interact with the site.
  This means there is less of a chance that server hacking
  can affect the content of a site.
- The supported markup/templating options are typically
  easier to write and understand than HTML.
- Development of an SSG site can start from
  a pre-built site to speed development.

See [staticgen.com](https://www.staticgen.com/) for a list
of SSGs that can be sorted on various criteria.

Key differentiators between SSGs include:

- supported template languages (Angular, EJS, Go, Haml,
  Handlebars, HTML, JavaScript, Liquid, Markdown, Marko,
  Mustache, Nunjucks, Pug, React, Swig, Twig, Vue, ...)
- the implementation language (Go, JavaScript, PHP, Python, Ruby, ...)
  which affects your ability to customize the software
- ability to configure the SSG to use
  existing content files and directory structures
- license (Apache-2.0, Jinja2, MIT, ...)

For static sites that obtain data from API services,
a common strategy is to automatically regenerate them
on a scheduled basis such as every night.
This is typically quite easy to implement.

Another strategy is to store all the files for a site
in a repository such as GitHub and automatically
rebuild and redeploy the site any time changes are pushed.

## 11ty overview

11ty is "a simple static style generator" (SSG).
It is targeted at building static "sites", not web "apps".
11ty is mostly written and maintained by Zach Leatherman.
It is implemented in JavaScript.

The rationale for the name "11ty" is explained
[here](https://www.zachleat.com/web/eleventy-birthday/#project-naming).
It is related to how Zach Leatherman learned to count as a child.

The 11ty mascot is a possum attached to a helium balloon.

11ty is the most popular SSG that supports multiple template languages.

A lot of big names in the web community love 11ty, including
Mathias Bynens, Chris Coyier, Rob Dodson, Brian Leroux,
Addy Osmani, Dave Rupert, and Sara Soueidan.

See https://www.11ty.dev/docs/testimonials/.

11ty supports many markup languages including:

- HTML in .html files
- Markdown in .md files

11ty supports many templating languages including:

- [Embedded JavaScript (EJS)](https://ejs.co/) in `.ejs` files
- [Haml](http://haml.info/) in `.haml` files
- [Handlebars](https://handlebarsjs.com/) in `.hbs` files
- JavaScript in `.11ty.js` files
- JavaScript Template Literals in `.jstl` files
- [Liquid](https://shopify.github.io/liquid/) in `.liquid` files
- [Mustache](https://mustache.github.io/) in `.mustache` files
- [Nunjucks](https://mozilla.github.io/nunjucks/) in `.njk` files (by Mozilla)
- [Pug](https://pugjs.org/) in `.pug` files

11ty does not currently support AsciiDoc.

An 11ty site can be built from source files that use
a combination of markup and templating languages.

An 11ty project can be configured to work with
existing content files and an existing directory structure.
It looks for template files in all project directories
and outputs `.html` files in the `_site` directory (by default)
with the same directory structure.
The convention to write files to the `_site` directory
was copied from Jekyll which inspired many parts of 11ty.

The build process requires Node, but sites generated by 11ty
do not require downloading any JavaScript code.
Serving only prebuilt pages provides great site performance.
JavaScript code can optionally be included for dynamic functionality.

## Why choose 11ty?

11ty competes with:

- Gatsby (React)
- Hugo (Go)
- Jekyll (Ruby)
- Next (React)
- Nuxt (Vue)
- Sapper (Svelte)
- and more

What distinguishes 11ty from other popular SSGs
is that it is more inclusive.
Content can be contributed from people with a variety of skill sets.
Most SSGs support Markdown content.
But there are typically features that can only be used
by contributors that know
a particular web framework (such as React or Vue)
or programming language (such as Ruby or Go).

11ty also has features that can only be used by programmers,
but they only need to know basic JavaScript.
For contributors that are programmers, it's more likely they
will know JavaScript than other programming languages.

11ty supports a wide variety of templating languages listed earlier
and use of these can be mixed within the same site.
All the supported templating languages are easy to learn,
much easier than learning a new web framework or programming language.
This increases the pool of potential contributors to a site.

## Resources

See the project home page at [11ty.dev](http://11ty.dev).

A great tutorial video by Kyle Mitofsky can be found at
https://www.youtube.com/watch?v=ozTesGh0l74

See the video series from Brian Robinson at his
[blog](https://bryanlrobinson.com/blog/create-11ty-theme-from-static-html-template/).

See Khaled Garbaya's video series on
[Egghead](https://egghead.io/lessons/11ty-bootstrap-an-eleventy-project?pl=getting-started-with-eleventy-53c2).

## Error handling

See https://github.com/stevenpetryk/eleventy-plugin-error-overlay.

## Markdown

Markdown is a syntax for specifying HTML in a simpler way.
It was created by John Gruber and is
defined [here](https://daringfireball.net/projects/markdown/).

There are many Markdown parsers.
The one that 11ty uses by default is
[markdown-it](https://github.com/markdown-it/markdown-it).

Let's review the most commonly used parts of Markdown syntax.

- **headers**: `#` (h1) to `######` (h6)

- **italic**: `*text*` or `_text_`
- **bold**: `**text**` or `__text__`
- **bold and italic**: `**_text_**` or `__*text*__`
- **strikethrough**: `~~text~~`

- **block quotes**: precede each line with `>`; text is automatically wrapped

- **code in a line**: surround with single backticks
- **code on multiple lines**: surround with lines containing three backticks; follow first line of backticks with a language identifier; ex. `---js`

- **horizontal rule**: three or more hyphens, asterisks, or underscores;
  each produces the same result

- **HTML**: can include most HTML tags

- **image**: `![alt-text](url)`
- **image with tooltip**: `![alt-text](url "tooltip")`

- **link displaying url**: `<url>`
- **link displaying text**: `[text](url)`
- **link displaying text with tooltip**: `[text](url "tooltip")`

- **unordered list**: precede each list item with `*`, `-`, or `+`
- **ordered list**: precede each list item with `1.`
  or uses a specific number to begin there

  - lists of any type can be nested by indenting two spaces

- **tables**

  ```md
  | Heading 1 | Heading 2 | Heading 3 | Heading 4 |
  | --------- | :-------- | --------: | :-------: |
  | data 1-1  | data 1-2  |  data 1-3 | data 1-4  |
  | data 2-1  | data 2-2  |  data 2-3 | data 2-4  |
  ```

  Colons in second line indicate horizontal alignment of a column.
  Column 1 is left-aligned by default.
  Column 2 is explicitly left-aligned.
  Column 3 is right-aligned.
  Column 4 is centered.

  Even if the column values are not aligned in the Markdown,
  a properly aligned table will be produced.
  Each heading must have at least three dashes below it.
  The outer pipes can be omitted.
  The VS Code markdownlint extension automatically fixes all these issues.

- **escaping**: precede characters with `\`

### GitHub extensions

- @ mention: `@github-username`
- emoji: `:emoji-name:`;
  examples include `:+1:` (thumbs up), `:tada:` (party hat), and `:rocket:`
- issue reference: `#issue-number`
- task list:
  - `- [ ] some uncompleted task`
  - `- [x] some completed task`

## YAML

[YAML](https://yaml.org/) stands for "YAML Ain't Markup Language".
In is an alternative to markup languages like JSON and XML.

YAML supports the same basic data types as JavaScript,
booleans, numbers, strings, arrays, and objects (a.k.a hash or dictionary).
Boolean values are `true` and `false`.
Number values are written as expected.
Strings containing no spaces or special characters do not require quotes.
When quotes are needed, they can be single or double quotes.

Arrays are specified by listing each element preceded by a dash and a space.
For example:

```yaml
colors:
  - red
  - green
  - blue
```

Objects (a.k.a dicts) are written as key/value pairs
on separate, indented lines where keys are followed by a colon.
For example:

```yaml
address:
  street: 123 Some Lane
  city: Somewhere
  state: CA
  zip: 12345
```

Arrays can hold objects and other arrays..
Object property values can be arrays and other objects.

Comments begin with `#` and extend to the end of the line.
Multi-line comments are not supported.

## Front matter

Files processed by 11ty can begin with front matter.
This starts with a line containing only three dashes
and ends with the same kind of line.
Lines between these define variables.
Variables can be used other files and can represent many kinds of values
including CSS property values, icons, URLs, ...

By default this expects YAML syntax.
For example:

```yaml
---
layout: layout.njk
title: Dogs
---

```

To use JavaScript syntax instead, add `js` after the opening dashes.
For example:

```js
---js
{
  layout: 'layout.njk',
  title: 'Dogs'
}
---
```

Some special variables recognized by 11ty include:

- layout:
  uses a layout template found in the `_includes` directory
- tags:
  single string or array of collection names to which this data belongs
- date: overrides the default file creation date to change sort order
- pagination:
  enables iteration over data in front matter to
  output multiple HTML files from this template
- permalink:
  changes the output target of the template
- dynamicPermalink:
  enables or disables template syntax in permalink values (default is true)
- templateEngineOverride:
  overrides the template engine used for this file
- eleventyExcludeFromCollections:
  true to exclude this content from collections

TODO: Are there any Nunjucks-specific variables?
TODO: See your front matter question at
TODO: https://github.com/11ty/eleventy/issues/916#issuecomment-583764086.

## 11ty configuration

Configuration options for 11ty are documented
[here](https://www.11ty.dev/docs/config/).

By default the file `.eleventy.js` is used
to specify configuration options for 11ty.
This file makes its default export
either an object or a function.
When it is a function, it has the structure shown below.
When it is an object, it is like the return value of this function.

This example configuration explicitly
sets each option to its the default value.

```js
module.exports = eleventyConfig => {
  //TODO: Add examples of adding filters, shortcodes, custom tags,
  //TODO: JavaScript functions, custom collections, and plugins.

  eleventyConfig.addLinter('linter-name', (content, inputPath, outputPath => {
    // Add code to lint template output
    // in "content" that came from "inputPath".
    // Error messages can include "inputPath".
    // Presumably if anything is fixed,
    // updated content should be written to "outputPath".
  });

  // Copies files in a given directory to output directory
  // without performing any processing on them.
  eleventyConfig.addPassthroughCopy('assets');

  eleventyConfig.addTransform('transform-name', (content, outputPath => {
    // Add code to transform template output in content
    // and write the result to outputPath.
    // For example, this can be used to format or minify output HTML.
  });

  // Rebuilds the site if any files in a watch target directory change.
  //TODO: What directories are watched by default?
  //TODO: Probably the data, includes, input, and layouts directories.
  // This is an example, not the default value.
  eleventyConfig.addWatchTarget("./scss/");

  // Overrides BrowserSync default configuration options.
  // None are overridden by default.
  eleventyConfig.setBrowserSyncConfig({ options });

  // Performs deep merge of data from sources in data cascade.
  // This currently defaults to false, but may change to true soon.
  eleventyConfig.setDataDeepMerge(false);

  // Override default configuration options of the gray-matter package
  // which is used to parse front matter.
  // See https://github.com/jonschlinkert/gray-matter.
  eleventyConfig.setFrontMatterParsingOptions({
    options
  });

  // Suppresses output of the paths of all generated files.
  eleventyConfig.setQuietMode(false);

  // Watches all JavaScript templates and data files
  // and rebuilds the site if they change.
  eleventyConfig.setWatchJavaScriptDependencies(true);

  return {
    dataTemplateEngine: 'liquid', // used in global data files
    dir: { // specifies the directory for various kinds of files
      data: '_data', // for global data files
      includes: '_includes', // for layouts and more
      input: '.',
      layouts: // defaults to the includes value
      output: '_site'
    },
    htmlOutputSuffix: '-o', // rarely useful
    htmlTemplateEngine: 'liquid', // used in HTML files
    jsDataFileSuffix: '.11tydata', // for template & directory data files
    // No processing is allowed in JSON files,
    // so no template engine can be specified.
    markdownTemplateEngine: 'liquid', // used in Markdown files
    pathPrefix: '/', // prepended to all URL paths
    templateFormats: [
      '11ty.js', 'ejb', 'haml', 'hbs', 'html',
      'liquid', 'md', 'mustache', 'njk', 'pug'
    ]
  };
};
```

TODO: Why goes in the "includes" directory besides layout files?
ANSWER: include files, extends files, partials, and macros
TODO: But what are these?

## Templating language choice

The default templating language available for use in Markdown files is Liquid.
Liquid was created by Shopify.
It is implemented in Ruby.

Another popular option is Nunjucks.
It was created by Mozilla and is implemented in JavaScript.
Nunjucks is very similar to Liquid.
Much of the syntax is identical.
But Nunjucks has many features that are not present in Liquid.

For details on Nunjucks syntax, see my notes file `NunjucksNotes.md` and
[Nunjucks Templating](https://mozilla.github.io/nunjucks/templating.html)
It's a pretty extensive language!

It is not necessary to install Nunjucks in order to use it in 11ty.
However, it must be enabled.
To enable use of Nunjucks in a particular Markdown file,
add the following front matter:

```yaml
templateEngineOverride: njk,md
```

To enable use of Nunjucks in all Markdown files,
configure it in `.eleventy.js` using one of these approaches:

```js
module.exports = {
  markdownTemplateEngine: 'njk',
};
```

or

```js
module.exports = (eleventyConfig) => {
  // Call methods on eleventyConfig here.

  return {
    markdownTemplateEngine: 'njk',
  };
};
```

All the code examples that follow assume the use of Nunjucks.

## Starter Themes

There are many free and commercial themes
that can be used as starting points and customized.
Google for "free Bootstrap theme" or "free HTML template".
Search sites like [ThemeForest](https://themeforest.net/),
[ThemeHunt](https://themehunt.com/),
and [ThemeHut](https://themehut.blogspot.com/).
One example is [Flat Theme Lite](https://themehunt.com/item/1524965-flat-theme-lite-free-responsive-multipurpose-site-template).

## Steps to create an 11ty site

This example uses Markdown and Nunjucks.

1. Install [Node.js](https://nodejs.org/en/).
1. Create a project directory and `cd` to it.
1. Enter `npm init` and answer questions
   or enter `npm init -y` to skip the questions.
1. Enter `npm install -D @11ty/eleventy`.
1. Create an `index.md` file.

   ```md
   # Mark Volkmann's Blog
   ```

1. Create an `about.md` file.

   ```md
   # About Mark Volkmann

   Mark is a software engineer at Object Computing, Inc. in St. Louis, Missouri.
   ```

1. Optionally build the site by entering `npx eleventy`.
   This creates a `_site` directory containing HTML files.
   `index.md` -> `index.html`
   `about.md` -> `about/index.html`

1. Build and serve the site locally
   with hot reloading using BrowserSync by entering
   `npx eleventy --serve`.

1. Browse localhost:8080 and localhost:8080/about.

If the project is placed in a Git repository,
add `_site/` to the `.gitignore` file
since that only contains generated code.

Optionally add these npm scripts in `package.json`
that can be used to build and serve the site:

```json
"build": "eleventy",
"clean": "rm -rf _site",
"start": "eleventy --serve"
```

The `eleventy` command outputs:

- a list of each file it produces
- the time it takes to execute JavaScript functions that retrieve data
- the total time taken to build the site.

If the `--serve` option is used,
it also outputs local and external URLs for
the 11ty server and the BrowserSync admin page.

Including the `--quiet` option suppresses
the list of files produced and the time to execute JavaScript functions.

For help on other options, enter `npx eleventy --help`.

## Deploying 11ty sites

An 11ty site can be published to a server
by copying the contents of the `_site` directory
to the server.

A service like Netlify or Zeit NOW can be used
to associate a site repository so
the site is rebuilt and deployed on every push.

### GitHub Pages

GitHub Pages is a great option to consider because it is free.

Here are the steps to deploy an 11ty site to GitHub Pages.

1. Install Node.js if not already installed by browsing
   [nodejs.org](http://nodejs.org).
1. Install git if not already installed.
1. Create a GitHub account if you don't already have one.
1. Create a new GitHub repository.
   Check the checkbox "Initialize this repository with a README".
   Having a `README.md` file is required
   to enable some options in gh-pages (which?).
1. Clone the repository to create a local version of the repository.
1. cd into the directory of the local repository.
1. Enter `npm init -y` to create a `package.json` file.
1. Enter `npm install -D gh-pages @11ty/eleventy npm-run-all`.
1. Create a `.gitignore` file containing the line `/node_modules`.
1. Edit `package.json` and replace the "test" script with the following:

   ```json
   "build": "eleventy",
   "commit": "git commit -av",
   "push": "git push origin master",
   "deploy": "gh-pages -d _site",
   "start": "npm-run-all build commit push deploy"
   ```

1. Create an `index.md` file with some basic content.
1. Build the site by entering `npx eleventy`.
1. Enter `npm run deploy`. This creates a remote branch named "gh-pages".
1. Enter `git add .`.
1. Enter `git commit -m "initial commit"`.
1. Enter `git push origin master`.
1. Browse the web UI for the GitHub repository.
1. Click "Settings" near the upper-right.
1. Scroll to the "GitHub Pages" section.
1. Under "Source", "gh-pages branch" should already be selected.
1. Click the link after "Your site is ready to be published at".

To make changes to the site:

1. Edit site source files.
1. Enter `npm start` to rebuild the site.
   This will prompt for a commit message that must be entered using Vim.
1. Browse the site to verify the changes.
   In can take 30 seconds or more for changes to appear on the site.
   Running deployments can be viewed at
   https://github.com/{username}/{repo-name}/deployments.

TODO: Consider converting your website to do this.

## Layouts

A layout defines a shell of content
into which the content of a page is injected.
For example, it can define a common page header and footer.
The page header could contain navigation links for visiting other pages.
The content for a page that uses a layout is inserted
at the location marked by `{{content | safe}}`.
`safe` is a Nunjucks filter that sanitized HTML.

Each page in an 11ty site can specify the layout to use.
There can be one layout that is used for all pages.
There can also be multiple layouts, each used by a different set of pages.

To define a layout:

1. Create a `_includes` directory to hold the layout files.

1. Create a layout file in this directory.
   It can use any templating language.
   For example, when using Nunjucks the file might be named `layout.njk`.

   ```njk
   <!DOCTYPE html>
   <html lang="en">
   <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <link rel="stylesheet" href="/assets/styles.css" />
   </head>
   <body>
    <h1>Mark Volkmann's Blog</h1>
    <nav> <!-- for accessible page navigation -->
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/about">About</a></li>
      </ol>
    </nav>
    <h2>{{title}}</h2> <!-- uses a variable defined in front matter -->
    <!-- Page content is inserted here. -->
    {{content | safe}}
   </body>
   </html>
   ```

1. Add the following front matter to the beginning of each content file:

   ```yaml
   ---
   layout: layout.njk
   title: 'some page title'
   ---

   ```

   `title` is a variable that can be used in the layout.

A layout can be chained.
For example, suppose the page defined in `about.md`
wishes to have its content wrapped by HTML that is not needed in all pages.
We can define another layout in `_includes/about-layout.njk`.
For example:

```njk
---
layout: layout.njk
---

<header>About Header</header>
{{content | safe}}
<footer>About Footer</footer>
```

Note that this layout refers to another layout.

Next we change the layout specified in the `about.md` front matter
to be `about-layout.njk`.
Now the content provided to `layout.md` will be the result
of inserting the content of `about.md` into `about-layout.njk`.

Layouts can be chained to any depth.

## Copying files to output

Some kinds of files do not require processing by 11ty,
but need to be copied to the `_site` directory
when the site is built.
They need to "pass through" 11ty processing.
These files include CSS and media files (images, audio, video, ...).

One way to achieve this is to place all of these files
in subdirectories below a directory named `assets`.
For example, this can have subdirectories named `css` and `images`.

Add the following in `.eleventy.js` to cause 11ty
to copy the `assets` directory to `_site` when the site is built.

```js
module.exports = function (eleventyConfig) {
  eleventyConfig.addPassthroughCopy('assets');
};
```

## Styling

To add CSS styling, configure the build process as shown above
and create `.css` files in the `assets/css` directory.

For example, to style nav links:

```css
nav {
  background-color: cornflowerblue;
  color: white;
}

li {
  margin-right: 1rem;
}

ul {
  display: flex;
  list-style: none;
  padding: 0.5rem;
}
```

One way to use the `.css` files is to add `link` tags in layout files.
Each layout file can include different `.css` files.
For example:

```html
<link rel="stylesheet" href="/assets/css/layout.css" />
<link rel="stylesheet" href="/assets/css/about.css" />
```

Another approach is the set a variable in template files
whose value is the path to a CSS file.
The variable can be used in a layout to include a `link` tag to the CSS file.
This allows each page template to include a different CSS file.

For example, a template can have this front matter:

```yaml
css: '/assets/css/about.css'
layout: layout.njk
```

A layout can use the variable like this:

```njk
{% if css %}
  <link rel="stylesheet" href="{{css}}" />
{% endif %}
```

There is no need to "scope" CSS to specific pages since each page
is built separately and loaded separately into the browser.

## Styling with Sass

Sass provides a modified CSS syntax that can be compiled to plain CSS.
Sass provides many benefits over CSS including
more compact variable assignment and usage,
nested rules, mixins, and provided functions.
For more details, see the [Sass home page](https://sass-lang.com/).

We can make converting `.scss` files to `.css` files
an automated part of the 11ty build process
by following these steps:

1. Create a `sass` directory at the top of the project
   and place all `.scss` in it.
1. Enter `npm install -D node-sass npm-run-all`.
1. Modify `package.json` to contain the following npm scripts:

```json
"build": "npm run sass && eleventy",
"sass": "node-sass sass --output assets/css",
"start": "npm-run-all sass --parallel watch:*",
"watch:eleventy": "eleventy --serve",
"watch:sass": "npm run sass -- --watch"
```

This assumes that all `.css` files will be
stored in the `assets/css` directory.
Now when `npm run build` is used to build the site
or when `npm start` is used to serve and watch the site,
`.scss` files in the `sass` directory will be
compiled to `.css` files in the `assets/css` directory.
Changes made to `.scss` files while `npm start` is running
will automatically be compiled to `.css` files
and the browser will reload to show the results.

The reason `.scss` files are not placed under the `assets` directory
is that `eleventyConfig.addPassthroughCopy` is being used to
copy the contents of the `assets` directory to `_site`.
We do not want to copy `.scss` files there
because they are not needed by the running site.

Optionally include the `--quiet` option on the `eleventy` commands.

## Collections

Collections are defined by specifying tags in front matter.
They are represented by an array of objects
whose properties are the non-tag front matter values
and some page-related properties added by 11ty.

TODO: How is the order of the objects in a collection determined?

For example, documents that each describe a specific dog
can have front matter similar to the following.

```yaml
tags: dog,
name: dasher,
breed: whippet
```

Multiple tags can be specified by listing them
in square brackets separated by commas.
This allows the data from a template to be in more than one collection.
For example, `tags: [dog, pet]`.

All templates can access `collections.dog` to
iterate over all the data related to dogs.

For example:

```js
{%- for dog in collections.dog -%}
  <p>{{ dog.data.name}} is a {{dog.data.breed}}.</p>
{%- endfor -%}
```

Note the use of `.data` to access the variables specified for a dog.

A layout can specify tags that become the default tags
for all pages that use the layout.
These can be overridden by specifying a different value for `tags` in a page.

Page-related properties that are added to collection objects by 11ty include:

- data: an object that holds the front matter variables
- date: the date and time at which the template file was created, not modified
- fileSlug: the part of the page URL that uniquely identifies it
- filePathStem: the file path in the page URL that uniquely identifies it
- inputPath: relative file path to the source template file
- outputPath: path to the output HTML file relative to the top of the project
- template: an object holds lots of 11ty-specific data
- templateContent: a string of HTML produced from the template
- url: the page URL

Storing the front matter variables in the `data` object
avoids name collisions with other page-related properties.

This information can be used to generate navigation links
in the main layout.
To do this, add a tag to each template that represents
a page that should be reachable from a nav link.
Also add a `title` variable to each of these templates.
For example, we can add the following front matter in `about.md`:

```yaml
tags: nav
title: About
```

Then generate navigation links in the main layout as follows:

```njk
<nav>
  <ol>
    {% for nav in collections.nav %}
      <li>
        <a href="{{nav.url}}">{{nav.data.title}}</a></li>
      </li>
    {% endfor %}
  </ol>
</nav>
```

The order of items in each collection is based on the creation timestamp
of the associated template file, from oldest to newest.
To iterate in reverse order use the `reverse` filter as follows:

```njk
{% for nav in collections.nav | reverse %}
```

For more information on 11ty collections,
see [collections](https://www.11ty.dev/docs/collections/).

## Collection sorting

Collections are sorted on the creation date of their documents.
To iterate over a collection in a different order,
add code in `.eleventy.js` that adds
a new collection that is sorted in the desired way.

For example:

```js
eleventyConfig.addCollection('dogsByName', (collection) => {
  // Get only the documents that have a tag of "dog".
  const dogs = collection.getFilteredByTag('dog');
  // Sort the dogs on their name.
  dogs.sort((dog1, dog2) => dog1.data.name.localeCompare(dog2.data.name));
  return dogs;
});
```

Use the collection `dogsByName` in a `for` loop
to iterate in the new sorted order.

This can be used allow each of the templates in the `nav` collection
described above to specify its order in the list of nav links.
To do this, add a `navOrder` variable to the front matter of each of these templates.
For example:

```yaml
navOrder: 3
```

Add a collection in `.eleventy.js` that holds
all the items in the `nav` collection,
but sorted on the `navOrder` values.
For example:

```js
eleventyConfig.addCollection('orderedNav', (collection) => {
  // Get only the documents that have a tag of "dog".
  const navs = collection.getFilteredByTag('nav');
  navs.sort((nav1, nav2) => nav1.data.navOrder - nav2.data.navOrder);
  return navs;
});
```

Finally, change the layout that renders the nav links
to iterate over `collections.orderedNav` instead of `collections.nav`.

## Data Cascade

Data in an 11ty project is held in variables.
Pages can access these variables.
Variables can be defined in multiple places, and
the "cascade" defines which definition takes precedence.

The places where variables can be defined,
from highest to lowest precedence, include:

- `{template-name}.{markup-extension}` in front matter
- front matter in layouts used by the template
- `{template-name}.11tydata.js` file in same directory
- `{template-name}.11tydata.json` file in same directory
- `{dir-name}.11tydata.js` file in same directory
- `{dir-name}.11tydata.json` file in same directory
- `{dir-name}.11tydata.js` files in ancestor directories
- `{dir-name}.11tydata.json` files in ancestor directories
- `{data-name}.js` file in the `_data` directory
- `{data-name}.json` file in the `_data` directory

JavaScript files can generate data and
retrieve it from REST services.
The use of the directory `_data` was inspired by Jekyll.

Data from a file whose name starts with `{template-name}.11tydata.`
is only available in template files in the same directory
whose name starts with `{template-name}.`.

Data from a file whose name starts with `{dir-name}.11tydata.`
is available in all template files in the same directory and below.

Directory files that are closer to a template file
take precedence over those higher in the directory hierarchy.
TODO: It seems layout front matter is given the lowest precedences,
TODO: but that does not match the docs.
TODO: See this issue you created: https://github.com/11ty/eleventy/issues/915

Let's walk through a comprehensive example to demonstrate
all the possible sources of data for a template.
Consider the following directory structure.
Each of these files define an array of dogs.
Any one of them can be used as the source of this data.
The files are numbered to indicate their precedence in
providing data used in `dogs.md` with 1 being the highest.

- \_includes
  - layout.njk (10)
- \_data
  - dogs.js (8)
  - dogs.json (9)
- level1
  - level1.11tydata.js (6)
  - level1.11tydata.json (7)
  - level2
    - dogs.11tydata.js (2)
    - dogs.11tydata.json (3)
    - level2.11tydata.js (4)
    - level2.11tydata.json (5)
    - dogs.md (1)

Here is example content from `_data/dogs.js`.
It exports an array of dogs.

```js
module.exports = [
  {name: 'Dasher', breed: 'Whippet'},
  {name: 'Maisey', breed: 'Treeing Walker Coonhound'},
  {name: 'Ramsey', breed: 'Native American Indian Dog'},
  {name: 'Oscar', breed: 'German Shorthaired Pointer'},
];
```

Here is example content from `_data/dogs.json`.
It defines a value for the global variable `dogs`.

```json
[
  {"name": "Dasher", "breed": "Whippet"},
  {"name": "Maisey", "breed": "Treeing Walker Coonhound"},
  {"name": "Ramsey", "breed": "Native American Indian Dog"},
  {"name": "Oscar", "breed": "German Shorthaired Pointer"}
]
```

Here is example content from `level1/level1.11tydata.js`,
`level1/level2/level2.11tydata.js`, and `level1/level2/dogs.11tydata.js`.
They all export an object with a `dogs` property
whose value is an array of dogs.

```js
module.exports = {
  dogs: [
    {name: 'Dasher JS1', breed: 'Whippet'},
    {name: 'Maisey JS1', breed: 'Treeing Walker Coonhound'},
    {name: 'Ramsey JS1', breed: 'Native American Indian Dog'},
    {name: 'Oscar JS1', breed: 'German Shorthaired Pointer'},
  ],
};
```

Here is example content from `level1/level1.11tydata.json`,
`level1/level2/level2.11tydata.json`, and `level1/level2/dogs.11tydata.json`.
They all define an object with a `dogs` property
whose value is an array of dogs.

```json
[
  {"name": "Dasher", "breed": "Whippet"},
  {"name": "Maisey", "breed": "Treeing Walker Coonhound"},
  {"name": "Ramsey", "breed": "Native American Indian Dog"},
  {"name": "Oscar", "breed": "German Shorthaired Pointer"}
]
```

Here is the content of `level1/level2.dogs.md`.
It defines an array of dogs using YAML syntax.

```md
---
dogs:
  - name: Dasher
    breed: Whippet
  - name: Maisey
    breed: Treeing Walker Coonhound
  - name: Ramsey
    breed: Native American Indian Dog
  - name: Oscar
    breed: German Shorthaired Pointer
layout: layout.njk
---

# Dogs

{% for dog in dogs %}
{{dog.name}} is a {{dog.breed}}.
{% endfor %}
```

The set of variables obtained from these sources is merged,
but their values are not.
For example, if a template defines `tags` to be `['dog', 'pet']`
and its layout defines `tags` to be `['canine', 'creature', 'pet']`
the result will be `['dog', 'pet']`.

As another example, consider a template with the following front matter:

```yaml
layout: myLayout.njk
title: 'Template Title'
```

Suppose `myLayout.njk` contains the following front matter:

```yaml
score: 7
title: 'Layout Title'
```

The data available in the template will be:

```js
{
  layout: myLayout.njk,
  score: 7,
  title: 'Template Title'
}
```

## Using data from a REST service

One way to make data from REST services available to templates
is to add `.js` files under the `_data` directory
whose names are the name of a global variable to set.

For example, the global variable `employees` can be set
by creating the file `_data/employees.js`
that uses the Fetch API to call a REST service.
To use the Fetch API, `npm install -d node-fetch`.

This file could contain the following:

```js
const fetch = require('node-fetch');

module.exports = async () => {
  const url = 'https://dummy.restapiexample.com/api/v1/employees';
  const res = await fetch(url);
  const response = await res.json();
  // This REST service returns an object with the properties
  // success and data where data is an array of employee objects.
  return response.data;
};
```

The employees can be rendered on a page like this:

```njk
{% for employee in employees %}
  <p>{{ employee.employee_name}} is {{employee.employee_age}} years old.</p>
{% endfor %}
```

We can also make data from a REST service available to
only a single template or only templates in and below a given directory.
For example, suppose the file `company/employees.md`
needs access to the employee data.
We can create the file `company/employees.11tydata.js`
or `company/company.11tydata.js` containing the following:

```js
const fetch = require('node-fetch');

module.exports = async () => {
  const url = 'https://dummy.restapiexample.com/api/v1/employees';
  const res = await fetch(url);
  const response = await res.json();
  // Any number of front matter variables
  // can be included in the returned object.
  return {employees: response.data};
};
```

## Shortcodes

Shortcodes define snippets of reusable content.
This is the closest thing 11ty provides to components
in web frameworks like React, Vue, Angular, and Svelte.
For example, here is a "dog" shortcode definition that is
defined in `.eleventy.js` to make it globally available.
When defined this way they are referred to as "universal shortcodes".

```js
eleventyConfig.addShortcode(
  'dog',
  (breed, name) => `
    <div class="dog">
      <div class="name">Name: ${name}</div>
      <div class="breed">Breed: ${breed}</div>
    </div>
  `
);
```

To use this shortcode:

```njk
{% for dog in collections.dogsByName %}
  {% dog dog.data.breed, dog.data.name %}
{% endfor %}
```

Shortcodes can be defined in any `.js` file.
For example, to define a shortcode that is only available
in and below the `company` directory,
define it in the file `company/company.11tydata.js`
as follows:

```js
module.exports = function ({firstName, lastName}) {
  return `<h1>${this.user(firstName, lastName)}</h1>`;
};
```

Shortcodes return a string of HTML that is often constructed
using a JavaScript template literal.
A downside of this approach is that it limits
the ability of tooling to detect syntax errors in the HTML.

TODO: Cover non-universal shortcodes?
TODO: Are these just plain JS functions that return a string of HTML?

TODO: Cover "paired shortcodes"?

If a snippet doesn't require any data to be supplied, a Nunjucks
[include](https://mozilla.github.io/nunjucks/templating.html#include)
can used as an alternative.

Another alternative is to use Nunjucks
[macros](https://mozilla.github.io/nunjucks/templating.html#macro).

Unlike web framework components, 11ty "components"
don’t have runtime behavior.
This makes them far simpler to implement.
All they do is render something based on data passed to them.

Two options to consider for implementing 11ty "components" are
JavaScript-focused shortcodes and markup focused Nunjucks macros.
TODO: See your svg.njk example in "my-project" and include that here.
TODO: Also see the "circle" shortcode defined in .eleventy.js.

## Permalinks

11ty permalinks specified in front matter change
the path of the output files produced within the `_site` directory.
They are useful when the source directory structure
does not match the desired output directory structure.

When permalinks are specified,
any links to those pages must be updated to match.
Previously generated files under `_site` are not removed
after permalinks are added or modified,
so delete the `_site` directory and build again.

For example, the file `dogs.njk` would normally
generate `_site/dogs/index.html`.
To change this to `_site/animals/canines/index.html`,
add the following front matter in `dogs.njk`:

```yaml
permalink: 'animals/canines/'
```

The trailing slash is required.
Including `index.html` is optional,
but that is the file that is actually created.

An error is reported if multiple files target the same permalink path.

Permalink values can include variable references.
For example:

```yaml
permalink: 'animals/{{species | slug}}'
```

Quotes must surround values that include variable references.
Using the `slug` filter encodes the value to ensure a valid URL.
This filter is provided by 11ty, not Nunjucks.

Permalinks can be used in conjunction with pagination
to change the paths to the files produced for each page.
This is described in the next section.

## Pagination

Pagination is the 11ty term for producing multiple files from one input file.
It operates on an array of data.
The `size` variable specifies the number of
array elements to be rendered on each page.
Often it is set to 1 to render each element on a separate page.
The array data can come from anywhere in the data cascade.

By default the URL for each page produced ends with a slash and a page number.

For example:

```yaml
pagination:
  data: employees # data over which to paginate
  size: 7 # number of employees per page
```

The global variable `pagination` holds related data.

- `pagination.data` holds the value of the
  pagination `data` property from the front matter.
- `pagination.pages` holds an array of items for each page.
  When the size is one the array holds each page item.
  When the size is greater than one it holds arrays of the items on each page.
  When `data` is an object rather than an array, it holds keys instead of items.
- `pagination.items` is an array of the objects
  to be rendered on the current page.
- `pagination.pages.length` is the number of pages.
- `pagination.pageNumber` holds the zero-based index of the current page.
- `pagination.firstPageLink` holds the URL of the first page (alias `first`).
- `pagination.firstPageHref` is the same, but omits `index.html` at end.
- `pagination.previousPageLink` holds the URL of the previous page (alias `previous`).
- `pagination.previousPageHref` is the same, but omits `index.html` at end.
- `pagination.nextPageLink` holds the URL of the next page; (alias `next`).
- `pagination.nextPageHref` is the same, but omits `index.html` at end.
- `pagination.lastPageLink` holds the URL of the last page (alias `last`).
- `pagination.lastPageHref` is the same, but omits `index.html` at end.
- `pagination.pageLinks` holds an array of all the page links (alias `links`).
- `pagination.href` holds an object with keys
  "previous", "next", "first", and "last" whose values are those hrefs.
- `pagination.hrefs` holds an array of all the page hrefs.

The URL for each page is `/{pagination.data}/{zero-based-index}`.
The URL for the first page page is simply `/{data-name}`.
The URL `/{data-name}/0` is not valid.

`pagination.items` holds the current page item when the size is 1
or an array of the current page items when size is greater than 1.
To add an alias for this add an `alias` property
to the `pagination` front matter.
For example:

```yaml
pagination:
  ...
  alias: items
```

With this alias in place, we can iterate over `items`
instead of `pagination.items` to render all the items on the current page.

To display "Page m of n":

```njk
<div>
  Page {{pagination.pageNumber + 1}} of {{pagination.pages.length}}
</div>
```

To render links to the first, previous, next, and last pages
so each is only rendered when it makes sense:

```njk
<nav class="pagination">
  <ol>
    {% if pagination.pageNumber > 0 %}
      <li><a href="{{pagination.href.first}}">First</a></li>
    {% endif %}
    {% if pagination.href.previous %}
      <li><a href="{{pagination.href.previous}}">Prev</a></li>
    {% endif %}
    {% if pagination.href.next %}
      <li><a href="{{pagination.href.next}}">Next</a></li>
    {% endif %}
    {% if pagination.pageNumber < pagination.pages.length - 1 %}
      <li><a href="{{pagination.href.last}}">Last</a></li>
    {% endif %}
  </ol>
</nav>
```

To render links to all the pages except the current by number:

```njk
<nav class="pagination">
  <ol>
    {% for href in pagination.hrefs %}
      {%if loop.index0 !== pagination.pageNumber %}
        <li><a href="{{href}}">Page {{ loop.index }}</a></li>
      {% endif %}
    {% endfor %}
  </ol>
</nav>
```

Note that Nunjucks provides the variable `loop` that holds
an object with the properties `index` (1-based) and `index0` (0-based).
These hold the current loop index.

To style the anchor tags as buttons:

```css
.pagination {
  background-color: transparent;
}

.pagination ol {
  display: flex;
  list-style: none;
  padding: 0.5rem 0; /* to match "a" padding below */
}

.pagination a {
  border: solid gray 1px;
  border-radius: 0.5rem;
  padding: 0.5rem;
  text-decoration: none;
}
```

To style the anchor for the current page differently that the others,
define a CSS rule for `a.current` and
set the `class` on the `a` elements as follows:

```njk
<a
  class="{{'current' if loop.index0 === pagination.pageNumber else ''}}"
  href="{{href}}"
>
```

To paginate data in reverse order,
add the `reverse` property to the `pagination` front matter.

```yaml
pagination:
  ...
  reverse: true
```

When `data` is an object rather than an array,
the items will be keys instead of items.
To change this so the items are the property values,
add the `resolve` property to the `pagination` front matter.

```yaml
pagination:
  ...
  resolve: values
```

To produce different data to be paginated from existing data,
use the `before` front matter property whose value is
a JavaScript function that takes the data and returns new data.
This can create new data to paginate by filtering, sort, and transforming.
Using this requires all the front matter
to be converted from YAML to JavaScript.
For example, the following filters the employees
so only those age 50 and older are retained
and it makes their names all uppercase:

```yaml
---js
{
  layout: 'employees-layout.njk',
  title: 'Employees',
  pagination: {
    data: 'employees',
    size: 7,
    alias: 'items',
    before(employees) {
      return employees.
        filter(emp => emp.employee_age >= 50).
        map(emp => ({
          ...emp,
          employee_name: emp.employee_name.toUpperCase()
        }));
    }
  }
}
---
```

To change the paths of the files produced for each page, specify a permalink.
For example, if the file `employees.njk` uses pagination then
it would normally generate files like `_site/employees/2/index.html`
where 2 is a page number.
To change this so it generates files like
`_site/workers/group-2/index.html`, add the following front matter:

```yaml
permalink: 'workers/group-{{pagination.pageNumber}}/index.html'
```

When a template uses pagination and gets data from a REST service
as shown above, the REST service is invoked once,
then again for each page.
So if pagination results in three pages,
there will be four calls to the REST service.
TODO: Why is this?
TODO: See the issue you created about pagination and .11ty.js files
TODO: at https://github.com/11ty/eleventy/issues/919.

## Global data

Global data can be defined in `.js` or `.json` files in the `_data` directory.
When defined in a `.js` file, it should export a function that returns the data.
For example, the file `_data/hockey.js` could contain:

```js
module.exports = () => [
  {city: 'Chicago', name: 'Blackhawks'},
  {city: 'St. Louis', name: 'Blues'},
];
```

TODO: Can the JavaScript code call a REST service to get the data?

To render this data in a template:

```njk
{%- for team in hockey -%}
  <p>The {{team.name}} play in {{team.city}}.</p>
{%- endfor -%}
```

## 11ty configuration

todo: cover details of the .eleventy.js file.

## CMS integration

TODO: How can an 11ty site use assets from a CMS like Strapi?

## Obtaining data from REST services

TODO: Add this.

## Plugins

The functionality of 11ty can be extended with plugins.
These are documented [here](https://www.11ty.dev/docs/plugins/).

### Syntax highlighting

Install the plugin.

```bash
npm install -D @11ty/eleventy-plugin-syntaxhighlight
```

Modify .eleventy.js:

```js
const syntaxHighlight = require('@11ty/eleventy-plugin-syntaxhighlight');
module.exports = eleventyConfig => {
  ...
  eleventyConfig.addPlugin(syntaxHighlight);
};
```

Download a Prism theme `.css` file from
[Prism themes](https://github.com/PrismJS/prism-themes)
and place it in the `assets` directory.
For example, `prism-vs.css`.

Add a `link` tag for this in all layout files whose pages need it.
For example, this can be added in `_includes/layout.njk`.

```html
<link rel="stylesheet" href="/assets/prism-vs.css" />
```

Surround code to have syntax highlighting with fences.
For example:

````text
 ```js
 code goes here
 ```
````

For more details, see the documentation [here](https://www.11ty.dev/docs/plugins/syntaxhighlight/).

There is also a way to trigger syntax highlighting
with Nunjucks, but some editors like VS Code
will change the indentation in code blocks
when using this approach.

### Internationalization

TODO: See https://www.webstoemp.com/blog/multilingual-sites-eleventy/.

```

```

## Debugging tips

To see the value of a variable in the devtools console,
use the 11ty `log` filter.
For example, `{{myVariable | log}}`.

To see the content of an array or object within a page,
use the Nunjucks `dump` filter which calls `JSON.stringify`.
For example, `<div>myVariable = {{myVariable | dump}}`.

## Publishing to GitHub Pages

The steps to publish an 11ty site to GitHub Pages are:

1. Create a GitHub account if you don't already have one.
1. Create a new GitHub repository for the site.
1. Clone the repository.
1. Add the files from an 11ty project to the repository.
1. Push the changes.
1. In the web UI for the repository, click "Settings" near the upper-right.
1. Enable the repository to be a GitHub Pages site. How?
