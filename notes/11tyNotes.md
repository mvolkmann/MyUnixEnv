# 11ty Notes

## Static site generators (SSGs)

SSGs are an alternative to CMS tools (like WordPress and Drupal)
and graphical site builders (like Squarespace and Wix).

The primary benefits of SSGs are:

- Static sites provide excellent runtime performance.
- Static sites are more secure because all API interactions
  occur during site generation, not when users interact with the site.
  This means there is less of a chance that server hacking
  can affect the content of a site.
- The supported markup/templating options are typically
  easier to write and understand than HTML.
- Development of an SSG site can start from
  a pre-built site to speed development.

See [staticgen.com](https://www.staticgen.com/) for a list
of SSGs that can be sorted on various criteria.

Key differentiators between SSGs include:

- supported template languages (Angular, EJS, Go, Haml,
  Handlebars, HTML, JavaScript, Liquid, Markdown, Marko,
  Mustache, Nunjucks, Pug, React, Swig, Twig, Vue, ...)
- the implementation language (Go, JavaScript, PHP, Python, Ruby, ...)
  which affects your ability to customize the software
- ability to configure the SSG to use
  existing content files and directory structures
- license (Apache-2.0, Jinja2, MIT, ...)

## 11ty overview

11ty is "a simple static style generator" (SSG).
It is targeted at building static "sites", not web "apps".
11ty is mostly written and maintained by Zach Leatherman.
It is implemented in JavaScript.

TODO: What is the origin of its name?

The 11ty mascot is a possum attached to a helium balloon.

11ty is the most popular SSG that supports multiple template languages.

A lot of big names in the web community love 11ty, including
Mathias Bynens, Chris Coyier, Brian Leroux, Addy Osmani, Sara Soueidan
See https://www.11ty.dev/docs/testimonials/.

11ty competes with:

- Gatsby (React)
- Hugo (Go)
- Jekyll (Ruby)
- Next (React)
- Nuxt (Vue)
- Sapper (Svelte)
- and more

11ty supports many templating languages (11) including:

- Embedded JavaScript (EJS) in .ejs files
- Haml in .haml files
- Handlebars in .hbs files
- HTML in .html files
- JavaScript in .11ty.js files
- JavaScript Template Literals in .jstl files
- Liquid in .liquid files
- Markdown in .md files
- Mustache in .mustache files
- Nunjucks in .njk files (by Mozilla)
- Pug in .pug files

It does not currently support AsciiDoc.

An 11ty site can be built from source files
that use a combination of templating languages.

An 11ty project can be configured to work with
existing content files and an existing directory structure.
It looks for template files in all project directories
and outputs `.html` files in the `_site` directory (by default)
with the same directory structure.

The build process requires Node, but sites generated by 11ty
do not require downloading any JavaScript code.
Serving only prebuilt pages provides great site performance.
JavaScript code can optionally be included for dynamic functionality.

## Resources

See the project home page at [11ty.dev](http://11ty.dev).

A great tutorial video by Kyle Mitofsky can be found at
https://www.youtube.com/watch?v=ozTesGh0l74

See the video series from Brian Robinson at his
[blog](https://bryanlrobinson.com/blog/create-11ty-theme-from-static-html-template/).

See Khaled Garbaya's video series on [Egghead](https://egghead.io/lessons/11ty-bootstrap-an-eleventy-project?pl=getting-started-with-eleventy-53c2).

## Starter Themes

There are many free and commercial themes
that can be used as starting points and customized.
Google for "free Bootstrap theme" or "free HTML template".
Search sites like [ThemeForest](https://themeforest.net/),
[ThemeHunt](https://themehunt.com/),
and [ThemeHut](https://themehut.blogspot.com/).
One example is [Flat Theme Lite](https://themehunt.com/item/1524965-flat-theme-lite-free-responsive-multipurpose-site-template).

## Steps to create an 11ty site

This example uses Markdown and Nunjucks.

1. Create project directory.
1. Enter `npm init`.
1. Enter `npm i @11ty/eleventy`.
1. Create an `index.md` file.

   ```md
   # Mark Volkmann's Blog
   ```

1. Create an `about.md` file.

   ```md
   # About Mark Volkmann

   Mark is a software engineer at Object Computing, Inc. in St. Louis, Missouri.
   ```

1. Optionally build the site by entering `npx eleventy`.
   This creates a `_site` directory containing HTML files.
   `index.md` -> `index.html`
   `about.md` -> `about/index.html`

1. Build and serve the site locally
   with hot reloading using BrowserSync by entering
   `npx eleventy --serve`.

1. Browse localhost:8080 and localhost:8080/about.

If the project is placed in a Git repository,
add `_site/` to the `.gitignore` file
since that only contains generated code.

Optionally add these npm scripts in `package.json`
that can be used to build and serve the site:

```json
"build": "eleventy",
"start": "eleventy --serve"
```

## Deploying 11ty sites

An 11ty site can be published to a server
by copying the contents of the `_site` directory
to the server.

A service like Netlify or Zeit NOW can be used
to associate a site repository so
the site is rebuilt and deployed on every push.

TODO: Show the steps to deploy an 11ty site to GitHub Pages which is free.
TODO: Consider converting your website to do this.

## Front matter

Files processed by 11ty can begin with YAML front matter.
This begins with a line containing only three dashes
and ends with the same kind of line.
Lines between these define variables.
For example:

```yaml
---
layout: layout.njk
title: Dogs
---

```

Variables can be used other files and can represent many kinds of values
including CSS property values, icons, URLs, ...

Some special variables recognized by 11ty include:

- layout:
  uses a layout template found in the `_includes` directory
- tags:
  single string or array of collection names to which this data belongs
- date: overrides the default file creation date to change sort order
- pagination:
  enables iteration over data in front matter to
  output multiple HTML files from this template
- permalink:
  changes the output target of the template
- dynamicPermalink:
  enables or disables template syntax in permalink
- templateEngineOverride:
  overrides the template engine used for this file
- eleventyExcludeFromCollections:
  true to exclude this content from collections

TODO: Are there any Nunjucks-specific variables?

## Layouts

To define layouts that are used for multiple pages:

1. Create a `_includes` directory to hold configuration files
   for layouts and more.

1. Create the file `layout.njk` in this directory.
   This uses the Nunjucks templating language, but others can be used.
   The Nunjucks library does not need to be installed.
   For details on Nunjucks syntax, see
   [Nunjucks Templating](https://mozilla.github.io/nunjucks/templating.html)
   It's a pretty extensive language!

   ```njk
   <!DOCTYPE html>
   <html lang="en">
   <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <link rel="stylesheet" href="/assets/styles.css" />
   </head>
   <body>
    <h1>Mark Volkmann's Blog</h1>
    <nav> <!-- for page navigation -->
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </nav>
    <h2>{{title}}</h2>
    <!-- content is where page content is injected -->
    <!-- safe causes the HTML content to be sanitized -->
    {{content | safe}}
   </body>
   </html>
   ```

1. Add the following "front matter" to the beginning of each content file:

   ```yaml
   ---
   layout: layout.njk
   title: {the page title}
   ---

   ```

   Any number of pages can use the same layout file
   and a site can use any number of layout files.

   `title` is like a variable that can be used in the layout.

A layout can extend another layout.
What does this mean?

## Styling

1. Create an `assets` directory.
   The name isn't significant.

1. Create the file `styles.css` inside it
   with content like the following:

   ```css
   nav {
     background-color: cornflowerblue;
     color: white;
   }

   li {
     margin-right: 1rem;
   }

   ul {
     display: flex;
     list-style: none;
     padding: 0.5rem;
   }
   ```

1. Create a `.eleventy.js` file at the top of the project with the following content:

```js
module.exports = function(eleventyConfig) {
  // This causses the build process to
  // copy the assets directory to _site.
  eleventyConfig.addPassthroughCopy('assets');
};
```

TODO: Is there a way to scope css to a page?

## Collections

Collections of data are defined by specifying tags in front matter.
For example, documents that each describe a specific dog
can have the following `tags: dog` in their front matter.

```yaml
tags: dog,
name: dasher,
breed: whippet
```

Multiple tags can be specified by listing them
in square brackets separated by commas.
For example, `tags: ['dog', 'pet']`.
TODO: are the single quotes required here?

Other nunjucks documents can access a collection using a `for` loop.
for example:

```js
{%- for dog in collections.dog -%}
  <p>{{ dog.data.name}} is a {{dog.data.breed}}.</p>
{%- endfor -%}
```

Note the use of `.data` to access the variables specified for a dog.

A layout can specify tags that become the default tags
for all pages that use the layout.
These can be overridden by specifying a different value for `tags` in a page.

For more information on 11ty collections,
see [collections](https://www.11ty.dev/docs/collections/).

## Collection sorting

Collections are sorted on the creation date of their documents.
To iterate over a collection in a different order,
add code in `.eleventy.js` that adds
a new collection that is sorted in the desired way.

For example:

```js
eleventyConfig.addCollection('dogsByName', collection => {
  // Get only the documents that have a tag of "dog".
  const dogs = collection.getFilteredByTag('dog');
  // Sort the dogs on their name.
  dogs.sort((dog1, dog2) => dog1.data.name.localeCompare(dog2.data.name));
  return dogs;
});
```

Use the collection `dogsByName` in a `for` loop
to iterate in the new sorted order.

## Collections from a REST service

A collection can be populated from a REST call in `.eleventy.js`.

To use the Fetch API, `npm install -d node-fetch`.

For example:

```js
eleventyConfig.addCollection('employees', async () => {
  const url = 'https://dummy.restapiexample.com/api/v1/employees';
  const res = await fetch(url);
  return res.json();
});
```

This collection holds an array of employee objects in `employees.data`.
They can be rendered on a page like this:

```njk
{% for employee in collections.employees.data %}
  <p>{{ employee.employee_name}} is {{employee.employee_age}} years old.</p>
{% endfor %}
```

## Shortcodes

Shortcodes define snippets of reusable content.
For example, here is a "dog" shortcode definition
that is define in `.eleventy.js`.

```js
eleventyConfig.addShortcode(
  'dog',
  (breed, name) => `
    <div class="dog">
      <div class="name">Name: ${name}</div>
      <div class="breed">Breed: ${breed}</div>
    </div>
  `
);
```

This definition becomes globally available.
To use it:

```njk
{%- for dog in collections.dogsByName -%}
  {% dog dog.data.breed, dog.data.name %}
{%- endfor -%}
```

## Components

Are shortcodes the closest thing to components in 11ty?

## Global data

Global data can be defined in `.js` or `.json` files in the `_data` directory.
When defined in a `.js` file, it should export a function that returns the data.
For example, the file `_data/hockey.js` could contain:

```js
module.exports = () => [
  {city: 'Chicago', name: 'Blackhawks'},
  {city: 'St. Louis', name: 'Blues'}
];
```

TODO: Can the JavaScript code call a REST service to get the data?

To render this data in a template:

```njk
{%- for team in hockey -%}
  <p>The {{team.name}} play in {{team.city}}.</p>
{%- endfor -%}
```

## 11ty configuration

todo: cover details of the .eleventy.js file.

## Nunjucks

Nunjucks is a template language implemented in JavaScript.
It supports features seen in most programming languages.

The VS Code extension vscode-nunjucks
applies syntax highlighting in `.njk` files.

### Nunjucks configuration

To enable using Nunjucks in a specific Markdown file,
add the following in the front matter of a `.md` file:

```yaml
templateEngineOverride: njk,md
```

To enable using Nunjucks in all Markdown files,
add the following in `.eleventy.js`:

```json
markdownTemplateEngine: 'njk',
```

TODO: Cover other nunjucks-specific configuration.

### Nunjucks data types

Nunjucks essential supports the same data types as JavaScript.
These include:

- Boolean: true, false
- Numbers: 2, 3.4
- Strings: "in double-quotes", 'in single-quotes'
- Arrays: [true, 2, 'test']
- Dicts: { key1: true, key2: 'text' }

### Nunjucks operators

Nunjucks supports these mathematical operators:

- +, -, \*, /
- // (integer division)
- % (modulo)
- \*\* (exponentiation)

Nunjucks supports these comparison operators from JavaScript:

- ==, ===
- !=, !==
- <, <=, >=, >

Nunjucks supports these logical operators:

- and, or, not
- parentheses to group expressions

### Nunjucks comments

The syntax for comments is:

```njk
{# some comment #}
```

### Nunjucks variables

To define or modify a variable:

```njk
{% set name = value %}
```

Variables defined at the top-level are global.
Otherwise they are scoped to the construct in which they are defined.

### Nunjucks rendering

To render an expression, enclose it in double-curly braces.
For example:

```njk
{{ dog.name }}
```

### Nunjucks filters

Nunjucks can render the result of passing a value through a filter.
There are many provided filters and custom filters can be implemented.
The provided filters are listed
[here](https://mozilla.github.io/nunjucks/templating.html#builtin-filters).
They include `abs`, `batch`, `capitalize`, `center`, `default`,
`dictsort`, `dump`, `escape`, `first`, `float`, `forceescape`,
`groupby`, `indent`, `int`, `join`, `last`, `length`, `list`,
`lower`, `nl2br`, `random`, `rejectattr`, `replace`, `reverse`,
`round`, `safe`, `selectattr`, `slice`, `sort`, `string`, `striptags`,
`sum`, `title`, `trim`, `truncate`, `upper`, `urlencode`, `urlize`,
and `wordcount`.

There are too many to describe, but here are some highlights:

- `dump` calls `JSON.stringify` on a value and is useful for debugging.
- `first` returns the first element of an array or the first character of a string.
- `last` returns the last element of an array or the last character of a string.
- `groupby` creates an array of arrays of objects from an array of objects
  based on a common property value.
- `join` concatenates an array of values, separated by a delimiter
- `nl2br` replaces newline characters with HTML `<br />` elements
- `random` returns a random element from an array
- `rejectattr` filters an array of objects, rejecting those where a given property passes a test
- `selectattr` filters an array of objects, keeping those where a given property passes a test
- `sort` doesn't have an example in the docs.
  I submitted an issue to learn how to use it.
- `urlencode` encodes a URL using UTF-8.
- `urlize` turns URLs in a string into links.
  The string can contain any number of URLs.
  The result must be passed to the `safe` filter.
  Otherwise the resulting HTML is escaped and presented as plain text.
  For example, {{ 'before http://foo.bar after' | urlize | safe }}
  renders `before <a href="http://foo.bar">http://foo.bar</a> after`.

Here is an example of applying the `upper` filter to a string:

```njk
{{ dog.name | upper }}
```

Another syntax is available for applying a filter
to a large amount of content.
For example:

```njk
{% filter upper %}
  Mark is a software engineer at Object Computing, Inc.
{% endfilter %}
```

This form can only contain literal content, not other Nunjucks constructs.

### Nunjucks conditional logic

Content can be conditionally included using an `if` statement.
For example:

TODO: Change this rather than just copying from the official docs.

```njk
{% if hungry %}
  I am hungry.
{% elif tired %}
  I am tired.
{% else %}
  I am good!
{% endif %}
```

Nunjucks supports using and `if` for an odd kind of ternary operator.
For example, this outputs "yellow" if `happy` is true.

```njk
{{ "happy" if happy }}
```

This is similar, but outputs "gray" if `happy` is false.

```njk
{{ "yellow" if happy else "gray" }}
```

### Nunjucks iteration

A `for` loop iterates over the elements of an array.
This can be members of an 11ty collection.
For example:

```njk
{% for dog in dogs %}
  <li>{{ dog.name }} is a {{ dog.breed }}.</li>
{% else %}
  <li>There are no dogs.</li>
{% endfor %}
```

There is also support for asynchronous versions of this
(`asyncEach` and `asyncAll`) that most sites will not need.
It is documented
[here](https://mozilla.github.io/nunjucks/api.html#asynchronous-support).

### Nunjucks function calls

JavaScript functions can be called
using the same syntax as JavaScript.
For example, this calls a function and renders its result:

```njk
{{ someFunction(arg1, arg2) }}
```

### Nunjucks regular expressions

Regular expressions are defined by beginning with `r/`.
For example:

```njk
{% set re = r/^a.*z$/i %}
{% if re.test(dog.name) %}
  This dog goes from a to z!
{% endif %}
```

The `i` option at the end of the regular expression
signifies case-insensitive matching.

### Nunjucks sanitizing

When rendering HTML from a potentially untrusted source,
use the `safe` filter to sanitize it.
For example:

```njk
{{ someHtml | save }}
```

### Nunjucks macros

Macros are like functions that have parameters
and render something based on those.
Parameters can have default values that are used when a value is not provided.
For example:

```njk
{% macro dogP(name, breed, gender='unknown') %}
<p>{{name}} is a {{gender}} {{breed}}.</p>
{% endmacro %}
```

A macro call looks like a function call.
For example:

```njk
{%- for dog in collections.dogsByName -%}
  {{ dogP(dog.data.name, dog.data.breed, dog.data.gender) }}
{%- endfor -%}
```

Arguments can be specified positionally or by name.
For example:

```njk
{%- for dog in collections.dogsByName -%}
  {{ dogP(gender=dog.data.gender, breed=dog.data.breed, name=dog.data.name) }}
{%- endfor -%}
```

TODO: Maybe Nunjucks macros can be used as an alternative to 11ty shortcodes.
TODO: Can they be defined globally?

### Nunjucks blocks

Blocks in Nunjucks are like named slots in Svelte.
They allow a template to pass content into another template.
This is described [here](https://mozilla.github.io/nunjucks/templating.html#template-inheritance).

### Nunjucks includes

One template can include another.
This allows a template to be reused in many places.
For example:

```njk
{% include "snippet.html" %}
```

### Nunjucks whitespace

By default all whitespace is retained.
To trim whitespace before a construct, begin with `{%-` instead of `{%`.
To trim whitespace after a construct, end with `-%}` instead of `%}`.

### Nunjucks global functions

Nunjucks provides some predefined functions
that address common needs.

- `range` is used to iterate over a range of integer values.
- `cycler` rotates through a set of values.
- `joiner` returns a function that outputs a given string
  each time it is called except for the first

### Other Nunjucks topics

I haven't described these topics yet:
call, extends, import, raw, super, verbatim

## CMS integration

TODO: How can an 11ty site use assets from a CMS like Strapi?

## Obtaining data from REST services

TODO: Add this.

## Plugins

The functionality of 11ty can be extended with plugins.
These are documented [here](https://www.11ty.dev/docs/plugins/).

### Syntax highlighting

Install the plugin.

```bash
npm install -D @11ty/eleventy-plugin-syntaxhighlight
```

Modify .eleventy.js:

```js
const syntaxHighlight = require('@11ty/eleventy-plugin-syntaxhighlight');
module.exports = eleventyConfig => {
  ...
  eleventyConfig.addPlugin(syntaxHighlight);
};
```

Download a Prism theme `.css` file from
[Prism themes](https://github.com/PrismJS/prism-themes)
and place it in the `assets` directory.
For example, `prism-vs.css`.

Add a `link` tag for this in all layout files whose pages need it.
For example, this can be added in `_includes/layout.njk`.

```html
<link rel="stylesheet" href="/assets/prism-vs.css" />
```

Surround code to have syntax highlighting with fences.
For example:

````text
 ```js
 code goes here
 ```
````

For more details, see the documentation [here](https://www.11ty.dev/docs/plugins/syntaxhighlight/).

There is also a way to trigger syntax highlighting
with Nunjucks, but some editors like VS Code
will change the indentation in code blocks
when using this approach.

### Internationalization

TODO: See https://www.webstoemp.com/blog/multilingual-sites-eleventy/.

```

```
